<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.rezzo.mes.resour.insp.mapper.InspMapper">
    <select id="getOrdrList" parameterType="OrdrVO" resultType="OrdrVO">
        select RSC_CD, RSC_NM, rod.ORDR_NO, ORDR_CNT
        from RSC_ORDR ro,
             RSC_ORDR_DTL rod
        where ro.ORDR_NO = rod.ORDR_NO
          and ro.VEND_CD = #{vendCd}
          and
        <![CDATA[
        PAPRD_CMND_DT >= #{startDt}
          and PAPRD_CMND_DT <= #{endDt}
        ]]>
        order by PAPRD_CMND_DT
    </select>

    <select id="getVendList" resultType="VendVO">
        select VEND_CD, VEND_NM, BIZNO, TELNO
        from VEND
    </select>

    <select id="getVendListByKw" parameterType="VendVO" resultType="VendVO">
        select VEND_CD, VEND_NM, BIZNO, TELNO
        from VEND
        where VEND_NM like '%${vendNm}%'
           or VEND_CD = '${vendCd}'
    </select>

    <insert id="insertInspList" parameterType="List">
        insert all
        <foreach item="item" collection="list">
            into RSC_INSP (RSC_INSP_NO, INSP_DT)
            values (123, #{item.inspDt})
        </foreach>

        <foreach item="item" collection="list">
            into RSC_INSP_DTL (RSC_CD, RSC_INSP_NO, ORDR_NO, INSP_CNT, INSP_PASS_CNT, INSP_FAIL_CNT)
            values (#{item.rscCd},1234,#{item.ordrNo},#{item.inspCnt},#{item.inspPassCnt},#{item.inspFailCnt})
        </foreach>

        <foreach item="item" collection="list">
            <foreach collection="item.rscInf" item="infer">
                into RSC_INFER (RSC_CD, RSC_INSP_NO, INF_CD, INF_CNT)
                values (#{item.rscCd},1234,#{infer.ccdDtl},#{infer.infCnt})
            </foreach>
        </foreach>
        select * from DUAL
    </insert>
</mapper>
