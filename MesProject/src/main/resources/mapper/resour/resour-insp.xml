<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.rezzo.mes.resour.insp.mapper.InspMapper">
    <select id="getOrdrList" parameterType="RordrVO" resultType="RordrVO">
        select rod.RSC_CD, rod.RSC_NM, rod.ORDR_NO, rod.ORDR_CNT
        from RSC_ORDR ro,
             RSC_ORDR_DTL rod
        where ro.ORDR_NO = rod.ORDR_NO
          and ro.VEND_CD = #{vendCd}
          and
        <![CDATA[
        PAPRD_CMND_DT >= #{startDt}
          and PAPRD_CMND_DT <= #{endDt}
        ]]>
        order by PAPRD_CMND_DT
    </select>

    <select id="VendList" parameterType="VendVO" resultType="VendVO">
        select VEND_CD, VEND_NM, BIZNO, TELNO
        from VEND
        where VEND_NM like '%${vendNm}%'
          and VEND_CD like '%${vendCd}%'
    </select>

    <select id="RscList" resultType="RscVO">
        select RSC_CD, RSC_NM
        from RSC
        where RSC_NM like '%${rscNm}%'
          and RSC_CD like '%${rscCd}%'
    </select>

    <insert id="insertInspList" parameterType="List">
        insert all
        <foreach item="item" collection="list">
            into RSC_INSP (RSC_INSP_NO, INSP_DT)
            values (123, to_char(#{item.inspDt}, 'YYYY-MM-DD'))
        </foreach>

        <foreach item="item" collection="list">
            into RSC_INSP_DTL (RSC_CD, RSC_INSP_NO, ORDR_NO, INSP_CNT, INSP_PASS_CNT, INSP_FAIL_CNT)
            values (#{item.rscCd},1234,#{item.ordrNo},#{item.inspCnt},#{item.inspPassCnt},#{item.inspFailCnt})
        </foreach>

        <foreach item="item" collection="list">
            <foreach collection="item.rscInf" item="infer">
                into RSC_INFER (RSC_CD, RSC_INSP_NO, INF_CD, INF_CNT)
                values (#{item.rscCd},1234,#{infer.ccdDtl},#{infer.infCnt})
            </foreach>
        </foreach>
        select * from DUAL
    </insert>

    <select id="getRscInspList" parameterType="RordrVO" resultType="RscInspVO">
        select ri.RSC_INSP_NO, to_char(ri.INSP_DT, 'YYYY-MM-DD') INSP_DT, rid.RSC_CD, rsc.RSC_NM, rid.INSP_CNT, rid.INSP_PASS_CNT, rid.INSP_FAIL_CNT
        from RSC_INSP ri,
        RSC_INSP_DTL rid,
        RSC_ORDR_DTL rod,
        RSC_ORDR ro,
        RSC
        where ri.RSC_INSP_NO = rid.RSC_INSP_NO
        and rod.ORDR_NO = rid.ORDR_NO
        and rod.RSC_CD = rid.RSC_CD
        and ro.ORDR_NO = rod.ORDR_NO
        and rsc.RSC_CD = rid.RSC_CD
        <![CDATA[
          and ri.INSP_DT >= #{startDt}
          and ri.INSP_DT <= #{endDt}
        ]]>
        <if test="vendCd != ''">and ro.VEND_CD = #{vendCd}</if>
        <if test="rscCd != ''">and rid.RSC_CD = #{rscCd}</if>
    </select>
</mapper>
