<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style>
a {
	text-decoration: none;
}

body {
	font-size: 14px;
	color: #333;
}

li {
	list-style: none;
}

.card-header .tab {
	display: flex;
	justify-content: space-between;
}

.card-header .tab li a {
	font-size: 15px;
	color: #333;
	font-weight: 500;
}

/* 탭버튼 눌렀을시 글자 색상변경 */
.card-header .tab li.on a {
	font-weight: bold;
	color: crimson;
}
/* 탭박스 영역 기본 옵션은 디스플레이 숨김 */
.card-body .tabBox {
	display: none;
}
/* 탭버튼이 눌러졌을시 관련된 탭박스 활성화 */
.card-body .tabBox.on {
	display: block;
}
</style>
</head>
<body>
<!-- 본문내용 -->
<th:block layout:fragment="main">  

	<div class="container-fluid px-4">
		<h1 class="mt-4">공통코드관리</h1>
		<ol class="breadcrumb mb-4">
			<li class="breadcrumb-item"><a href="home.do">홈</a></li>
			<li class="breadcrumb-item">> 기준정보관리</li>
			<li class="breadcrumb-item active">> 공통코드관리</li>
		</ol>
		<div class="card mb-4">
			<div class="card-body">
				<label for="" autofocus="autofocus">코드명</label> <input type="text" id="selCcd" name="sleCcd" style="width: 150px">
				<button class="c_btn">검색</button>
			</div>
		</div>

		<div class="row">
			<div class="col-lg-6" style="width:35%">
				<div class="card mb-4">
					<div class="card-header">
					</div>
					<div class="card-body">
						<div id="grid"></div>
					</div>
					<div class="card-footer small text-muted"></div>
				</div>
			</div>
			<div class="col-lg-6" style="width:1%"></div>
			<div class="col-lg-6" style="width:64%">
				<div class="card mb-4">
					<div class="card-header">
						<ul class="tab">
							<li class="on"><a href="#!"><span>상세코드</span></a></li>
							<li><a href="#!"><span>코드정보</span></a></li>
						</ul>
					</div>
					<div class="card-body">
						<!-- 상세코드 탭 -->
						<div class="tabBox on">
							<div class="ccd">
								<div id="grid2"></div>
							</div>
						</div>
						<!-- 코드정도 탭 -->
						<div class="tabBox">
							<div class="linelist">
								<button class="c_btn" form="">등록</button>
								<button class="c_btn" form="">수정</button>
								<button class="c_btn" form="">삭제</button>
								<button class="c_btn" form="">취소</button>
							</div>
							<br> <br>
							 <form id="dataForm" name="dataForm" action="/comDta/cmmCodeUpdateAjax.do" method="post" autocomplete = "off">
                  <input type="hidden" id="clCode" name="clCode" value=""/>
                  <table class="table table-bbs table-write" summary="내용.....">
					          <colgroup>
					           <col style="width:200x">
					           <col>
					          </colgroup>
					        <tbody>
					         <tr>
					          <th>공통코드<strong class="blue">*</strong></th>
					          <td data-code-id=""><input type="text" id="codeId" name="codeId" class="form-control w150"  maxlength="10" /></td> 
					         </tr>
					         <tr>
					          <th>공통코드명<strong class="blue">*</strong></th>
					          <td ><input type="text" id="codeIdNm" name="codeIdNm" class="form-control" style="width:300px; background-color:#FFFFCC" maxlength="60"/></td> 
					         </tr>
					         <tr>
					          <th>코드설명</th>
					          <td><textarea id="codeIdDc" name="codeIdDc" rows="5" cols="100" class="form-control" maxlength="50"></textarea> 
					          <span class="letter-limit">
					          <strong id='limit'>0</strong>/50 byte
					          </span></td>
					         </tr>
					         <tr>
					          <th>사용여부</th>
					          <td>
					          	<select id="useAt" name="useAt" style="width:120px;height:24px">
						            <option value="Y" selected="selected">Yes</option>
						            <option value="N">No</option>
						          </select>
					          </td>
					         </tr>
					        </tbody>
                </table>
              </form>
						</div>
					</div>
					<div class="card-footer small text-muted"></div>
				</div>
			</div>
		</div>
	</div>
<script>
			//byte수 출력
			$(function(){
				$('#codeIdDc').keyup(function(){
					bytesHandler(this);
				});
			});

		function getTextLength(str) {
			var len = 0;

			for (var i = 0; i < str.length; i++) {
				if (escape(str.charAt(i)).length == 6) {
					len++;
				}
				len++;
			}
			return len;
		}

		function bytesHandler(obj){
			var text = $(obj).val();
			$('#limit').text(getTextLength(text));
		}
			
			
			// 코드화면(왼쪽) 그리드
			$.ajax({
				url: "ccdsList",
				method: "GET",
				dataType: "JSON",
				success: function (result) {
					grid.resetData(result);
					console.log(result);
				}
			});
			const grid = new tui.Grid({
				el: document.getElementById('grid'),
				scrollX: false,
				bodyHeight: 500,
				rowHeaders: ['rowNum'],
				columns: [{
					header: '공통코드',
					name: 'ccd',
					align: 'center',
					sortable: true,
          sortingType: 'desc'
				}, {
					header: '공통코드명',
					name: 'ccdNm',
					align: 'center',
					sortable: true,
          sortingType: 'desc'
				}]
			});
			
			//상세코드 그리드
			const grid2 = new tui.Grid({
				el: document.getElementById('grid2'),
				scrollX: false,
				bodyHeight: 500,
				rowHeaders: ['checkbox'],
				columns: [{
					header: '코드',
					name: 'ccdDtl',
					align: 'center',
					sortable: true,
          sortingType: 'desc'
				}, {
					header: '코드명',
					name: 'ccdDtlNm',
					align: 'center',
					sortable: true,
          sortingType: 'desc'
				}, {
					header: '코드설명',
					name: 'ccdDtlDesct',
					align: 'center',
					sortable: true,
          sortingType: 'desc'
				}, {
					header: '사용여부',
					name: 'useYn',
      		type: 'checkbox',
					align: 'center',
					sortable: true,
          sortingType: 'desc'
				}]
			})
			
			// 공통코드 클릭시 상세코드 리스트
			grid.on('click', ev => {
      var value = grid.getValue(ev.rowKey,'ccdNm');
      var keyword = grid.getValue(ev.rowKey,'ccd');
      $('#selCcd').val(value);
      
      //list 호출
      $.ajax({
				url: "ccdsSelect",
				method: "POST",
				data: {
					"keyword": keyword
				},
				success: function (result) {
					grid2.resetData(result);
				}
			});			

    });
			
			
			//탭
			$(document).ready(function(){
				$(".card-header .tab li a").on("click", function(){
					// 해당 요소를 클릭하는 내 자신의 index 번호를 가져온다. [0], [1]
					const num = $(".card-header .tab li a").index($(this));
					// 기존에 적용되어 있는 on class 삭제
					$(".card-header .tab li").removeClass("on");
					$(".card-body .tabBox").removeClass("on");

					// 다음 요소 클릭시 on class 추가
					$('.card-header .tab li:eq(' + num + ')').addClass("on");
					$('.card-body .tabBox:eq(' + num + ')').addClass("on");

				});
			});
</script>
</th:block>
</body>
</html>