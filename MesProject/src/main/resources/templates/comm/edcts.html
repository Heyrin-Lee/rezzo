<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}">
<head>
<meta charset="UTF-8">
<title>edcts.html</title>
</head>
<body>
<!-- 본문내용 -->
<th:block layout:fragment="main"> 
	<div class="container-fluid px-4">
		<h1 class="mt-4">완제품관리</h1>
		<ol class="breadcrumb mb-4">
				<li class="breadcrumb-item"><a href="home.do"><i class="fas fa-home"></i></a></li>
				<li class="breadcrumb-item">> 기준정보관리</li>
				<li class="breadcrumb-item active">> 완제품관리</li>
			</ol>
		<div class="card mb-4">
			<div class="card-body">
				<div class="linelist" style="float: right;">
						<button class="btn btn-primary" id="searchBtn"><i class="fas fa-search"></i> 조회</button>
						<button class="btn btn-primary" id="newBtn"><i class="fas fa-file"></i> 새자료</button>
						<button class="btn btn-primary" id="saveBtn"><i class="fas fa-save"></i> 저장</button>
						<button class="btn btn-primary" id="delBtn"><i class="fas fa-trash"></i> 삭제</button>
						<br> <br>
					</div>
						<form id="dataForm" name="dataForm" action="#" method="post">
							<table class="table" style="vertical-align : middle;">
								<colgroup>
									<col style="width: 150px">
									<col>
									<col style="width: 150px">
									<col>
									<col style="width: 150px">
									<col>
								</colgroup>
								<tbody>
									<tr>
										<th>완제품코드 <strong class="blue">*</strong></th>
										<td><input class="form-control" type="text" id="edctsCd" name="edctsCd" style="width: 250px" maxlength="20"
											placeholder="등록시 자동부여됩니다." readonly /></td>
										<th>제품명 <strong class="blue">*</strong></th>
										<td><input class="form-control" type="text" id="prdtNm" name="prdtNm" style="width: 250px" maxlength="50" /></td>
										<th>보관창고</th>
										<td>
											<select class="dataTable-selector" name="wrhousCd" id="wrhousCd" style="width: 250px">
												<option selected value="">==선택==</option>  
												<option th:each="code : ${ccds['WHS']}" th:value="${code.ccdDtl}" th:text="${code.ccdDtlNm}"></option>
											</select></td>
									</tr>
									<tr>
										<th>규격</th>
										<td><input class="form-control" type="text" id="spec" name="spec" style="width: 250px" maxlength="50" /></td>
										<th>단위</th>
										<td><input class="form-control" type="text" id="unit" name="unit" style="width: 250px" maxlength="50" /></td>
										<th>안전재고</th>
										<td><input type="text" id="safStc" name="safStc" class="form-control" maxlength="50" style="width: 250px" /></td>
									</tr>
								</tbody>
							</table>
						</form>
			</div>
		</div>
		<div class="card mb-4">
			<div class="card-body">
				<div id="grid"></div>
			</div>
		</div>
	</div>
<script>
const grid = new tui.Grid({
    el: document.getElementById('grid'),
			scrollX: false,
 		bodyHeight: 350,
  	rowHeaders: ['rowNum'],
    columns: [{
        header: '완제품코드',
        name: 'edctsCd',
        align: 'center',
      	sortable: true,
        sortingType: 'desc'
      },
      {
        header: '제품명',
        name: 'prdtNm',
        align: 'center',
      	sortable: true,
        sortingType: 'desc'
      },
      {
          header: '규격',
          name: 'spec',
          align: 'center',
        	sortable: true,
          sortingType: 'desc'
      },
      {
          header: '단위',
          name: 'unit',
          align: 'center',
        	sortable: true,
          sortingType: 'desc'
      },
      {
          header: '안전재고',
          name: 'safStc',
          align: 'center',
        	sortable: true,
          sortingType: 'desc'
      },
      {
          header: '보관창고',
          name: 'ccdDtlNm',
          align: 'center',
        	sortable: true,
          sortingType: 'desc'
      },
      {
          header: '보관창고',
          name: 'wrhousCd',
          align: 'center',
        	sortable: true,
          sortingType: 'desc'
      }
      
    ]
  });
  
  //테마 호버
  let hoverOption = {
      row: {
          hover: {
              background: 'rgba(19,78,94,0.2)'
          }
      }
  }
  tui.Grid.applyTheme('default', hoverOption);
  
  //컬럼숨기기
  grid.hideColumn('wrhousCd');
  
  //페이지 로딩시 실행
  getEdctsList();
  
 function getEdctsList() {
  	$.ajax({
  	    url: "getEdctsList",
  	    method: "POST",
  	    data: $('#dataForm').serialize(),
  	    dataType: "JSON",
  	    success: function (result) {
  	        grid.resetData(result);
  	    }
  		})
	}

//검색
$('#searchBtn').click(ev => {
	  getEdctsList();
	  toastr.success('정상적으로 조회되었습니다.');
 });
 
//폼 리셋
 $('#newBtn').click(ev => {
	   $('#dataForm')[0].reset();
 })
 
 let selectedRowKey = null;
 grid.on('focusChange', (ev) => {

	   //하이라이팅
   if (selectedRowKey != ev.rowKey) {
       grid.removeRowClassName(selectedRowKey, 'highlight');
   }
   selectedRowKey = ev.rowKey;
   grid.addRowClassName(selectedRowKey, 'highlight');
   
   //폼데이터 출력
   $('#edctsCd').val(grid.getValue(ev.rowKey, 'edctsCd'));
   $('#prdtNm').val(grid.getValue(ev.rowKey, 'prdtNm'));
   $('#spec').val(grid.getValue(ev.rowKey, 'spec'));
   $('#unit').val(grid.getValue(ev.rowKey, 'unit'));
   $('#safStc').val(grid.getValue(ev.rowKey, 'safStc'));
   $("select[name='wrhousCd']").eq(0).val(grid.getValue(ev.rowKey, 'wrhousCd'));
  
	});

//수정&입력
$('#saveBtn').click(ev => {
	  $.ajax({
		    url: "saveEdcts",
		    method: "POST",
      data: $('#dataForm').serialize(),
      dataType: 'json',
		    success: function (result) {
		    	toastr.success('정상적으로 저장되었습니다.');
		    	grid.resetData(result);
		    }
			})
 });

//삭제
$('#delBtn').click(ev => {
	  $.ajax({
		 	url: "delEdcts",
		  method: "POST",
      data: $('#dataForm').serialize(),
      dataType: 'json',
		    success: function (result) {
		    	toastr.success('정상적으로 삭제되었습니다.');
		    	grid.resetData(result);
		    }
			})
 });
</script>
</th:block>
</body>
</html>