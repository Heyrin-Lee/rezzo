<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- TUI -->
    <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
    <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>

    <link rel="stylesheet" href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css" />
    <script src="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.js"></script>

    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
            crossorigin="anonymous"></script>
    <style>
        .tui-datepicker {
            z-index: 100;
        }
    </style>

    <title>자재수입검사조회</title>
</head>

<body>
<h3>자재수입검사조회</h3>
<hr>

<input type="button" value="조회">
<input type="button" value="새로고침">
<input type="button" value="엑셀">
<input type="button" value="인쇄">
<hr>

<b>검사일자</b>
<div class="tui-datepicker-input tui-datetime-input tui-has-focus">
    <input id="startpicker-input" type="text" aria-label="Date">
    <span class="tui-ico-date"></span>
    <div id="startpicker-container" style="margin-left: -1px;"></div>
</div>
<span></span>
<div class="tui-datepicker-input tui-datetime-input tui-has-focus">
    <input id="endpicker-input" type="text" aria-label="Date">
    <span class="tui-ico-date"></span>
    <div id="endpicker-container" style="margin-left: -1px;"></div>
</div>
<hr>

<label for="vendNm"><b>업체명</b></label>
<input id="vendNm" type="text" placeholder="검색버튼을 이용하세요" required readonly>
<input id="vendCd" type="hidden">
<button id="vendModBtn" type="button">검색</button>
<hr>

<label for="rscNm"><b>자재명</b></label>
<input id="rscNm" type="text" placeholder="검색버튼을 이용하세요" required readonly>
<input id="rscCd" type="hidden">
<button id="rscModBtn" type="button">검색</button>
<hr>

<!-- Modal for vend search -->
<div class="modal fade" id="rscModal" tabindex="-1" aria-labelledby="rscModal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <b class="modal-title">자재검색</b>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="rsc-grid"></div>
            </div>
        </div>
    </div>
</div>

<!-- Modal for resource search -->
<div class="modal fade" id="vendModal" tabindex="-1" aria-labelledby="vendModal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <b class="modal-title">업체검색</b>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="vendSchForm">
                    <label>업체명<input type="text" name="vendNm" style="width:100px;"></label>
                    <label>업체코드<input type="text" name="vendCd" style="width:100px;"></label>
                    <input id="vendSch" type="button" value="검색">
                </form>
                <hr>
                <div id="vend-grid"></div>
                <p>선택 : 더블클릭</p>
            </div>
        </div>
    </div>
</div>

<div id="grid"></div>

</body>

<script>
    ///////////////////////////// init ////////////////////////////////
    window.addEventListener('load', function () {
        getVendListInit();
        getRscListInit();
    })

    ///////////////////////////// grid ////////////////////////////////
    // vend grid
    let vendGrid = new tui.Grid({
        el: document.getElementById('vend-grid'),
        scrollX: false,
        scrollY: false,
        columns: [
            {
                header: '업체코드',
                name: 'vendCd'
            },
            {
                header: '업체이름',
                name: 'vendNm'
            },
            {
                header: '사업자번호',
                name: 'bizno'
            },
            {
                header: '전화번호',
                name: 'telno'
            }
        ]
    })

    // rsc grid
    let rscGrid = new tui.Grid({
        el: document.getElementById('rsc-grid'),
        scrollX: false,
        scrollY: false,
        columns: [
            {
                header: '자재코드',
                name: 'rscCd'
            },
            {
                header: '자재명',
                name: 'vendNm'
            },
            {
                header: '자재단위',
                name: 'rscUnt'
            }
        ]
    })

    // main grid
    const grid = new tui.Grid({
        el: document.getElementById('grid'),
        scrollX: false,
        scrollY: false,
        rowHeaders: ['checkbox'],
        columns: [
            {
                header: '검사번호',
                name: 'inspCd'
            },
            {
                header: '검사일자',
                name: 'inspDt'
            },
            {
                header: '자재코드',
                name: 'matCd'
            },
            {
                header: '품명',
                name: 'matName'
            },
            {
                header: '검사량',
                name: 'inspCnt'
            },
            {
                header: '합격량',
                name: 'inspPass'
            },
            {
                header: '불량량',
                name: 'inspFail'
            },
            {
                header: '대표불량명',
                name: 'failSpcf'
            }
        ]
    });

    ///////////////////////////// date picker ////////////////////////////////
    let today = new Date();
    let picker = tui.DatePicker.createRangePicker({
        startpicker: {
            date: today,
            input: '#startpicker-input',
            container: '#startpicker-container'
        },
        endpicker: {
            date: today,
            input: '#endpicker-input',
            container: '#endpicker-container'
        }
    });

    ///////////////////////////// vendor ////////////////////////////////
    // declare vendor modal
    let vModal;
    vendModBtn.addEventListener('click', function () {
        vModal = new bootstrap.Modal(document.getElementById('vendModal'), {})
        vModal.show('vendModal');
    })

    // when vendor modal shown => refresh
    let vendModal = document.getElementById('vendModal');
    vendModal.addEventListener('shown.bs.modal', e => {
        vendGrid.refreshLayout();
    })

    // search vendors
    let vendSch = document.getElementById('vendSch');
    vendSch.addEventListener('click', function () {
        let data = new FormData(vendSchForm);
        let url = 'getVendListByKw'

        fetch(url, {
            method: 'POST',
            body: data
        }).then(res => res.json()).then(res => {
            vendGrid.innerHTML = '';
            vendGrid.resetData(res);
        })
    });

    // action in vendor modal
    vendGrid.on('dblclick', e => {
        let rowInfo = vendGrid.getRow(e.rowKey)
        vendNm.value = rowInfo.vendNm;
        vendCd.value = rowInfo.vendCd;
        vModal.hide(vendModal);
    })

    // get vendor grid data
    function getVendListInit() {
        let url = 'getVendList'
        fetch(url).then(res => res.json())
            .then(res => vendGrid.resetData(res))
    }

    ///////////////////////////// resource ////////////////////////////////
    let rModal;
    rscModBtn.addEventListener('click', function () {
        rModal = new bootstrap.Modal(document.getElementById('rscModal'), {})
        rModal.show('rscModal');
    })

    // when rsc modal shown => refresh
    let rscModal = document.getElementById('rscModal');
    rscModal.addEventListener('shown.bs.modal', e => {
        rscGrid.refreshLayout();
    })

    // search rsc
    let rscSch = document.getElementById('rscSch');
    rscSch.addEventListener('click', function () {
        let data = new FormData(rscSchForm);
        let url = 'getRscListByKw'

        fetch(url, {
            method: 'POST',
            body: data
        }).then(res => res.json()).then(res => {
            rscGrid.innerHTML = '';
            rscGrid.resetData(res);
        })
    });

    // action in vendor modal
    rscGrid.on('dblclick', e => {
        let rowInfo = rscGrid.getRow(e.rowKey)
        rscNm.value = rowInfo.rscNm;
        rscCd.value = rowInfo.rscCd;
        rModal.hide(rscModal);
    })

    // get vendor grid data
    function getRscListInit() {
        let url = 'getRscList'
        fetch(url).then(res => res.json())
            .then(res => rscGrid.resetData(res))
    }


</script>

</html>